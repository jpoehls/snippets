/*

 (c) 2009-2010 Michael Leibman (michael.leibman@gmail.com)
 http://github.com/mleibman/slickgrid
 Distributed under MIT license.
 All rights reserved.

 SlickGrid v1.4.2

 TODO:
 - frozen columns
 - consistent events (EventHelper?  jQuery events?)


 OPTIONS:
 rowHeight                - (default 25px) Row height in pixels.
 enableAddRow             - (default false) If true, a blank row will be displayed at the bottom - typing values in that row will add a new one.
 leaveSpaceForNewRows     - (default false)
 editable                 - (default false) If false, no cells will be switched into edit mode.
 autoEdit                 - (default true) Cell will not automatically go into edit mode when selected.
 enableCellNavigation     - (default true) If false, no cells will be selectable.
 enableCellRangeSelection - (default false) If true, user will be able to select a cell range.  onCellRangeSelected event will be fired.
 defaultColumnWidth       - (default 80px) Default column width in pixels (if columns[cell].width is not specified).
 enableColumnReorder      - (default true) Allows the user to reorder columns.
 asyncEditorLoading       - (default false) Makes cell editors load asynchronously after a small delay.
 This greatly increases keyboard navigation speed.
 asyncEditorLoadDelay     - (default 100msec) Delay after which cell editor is loaded. Ignored unless asyncEditorLoading is true.
 forceFitColumns          - (default false) Force column sizes to fit into the viewport (avoid horizontal scrolling).
 enableAsyncPostRender    - (default false) If true, async post rendering will occur and asyncPostRender delegates on columns will be called.
 asyncPostRenderDelay     - (default 60msec) Delay after which async post renderer delegate is called.
 autoHeight               - (default false) If true, vertically resizes to fit all rows.
 editorLock               - (default Slick.GlobalEditorLock) A Slick.EditorLock instance to use for controlling concurrent data edits.
 showSecondaryHeaderRow   - (default false) If true, an extra blank (to be populated externally) row will be displayed just below the header columns.
 secondaryHeaderRowHeight - (default 25px) The height of the secondary header row.
 syncColumnCellResize     - (default false) Synchronously resize column cells when column headers are resized
 rowCssClasses            - (default null) A function which (given a row's data item as an argument) returns a space-delimited string of CSS classes that will be applied to the slick-row element. Note that this should be fast, as it is called every time a row is displayed.
 cellHighlightCssClass    - (default "highlighted") A CSS class to apply to cells highlighted via setHighlightedCells().
 cellFlashingCssClass     - (default "flashing") A CSS class to apply to flashing cells (flashCell()).
 formatterFactory         - (default null) A factory object responsible to creating a formatter for a given cell.
 Must implement getFormatter(column).
 editorFactory            - (default null) A factory object responsible to creating an editor for a given cell.
 Must implement getEditor(column).
 multiSelect              - (default true) Enable multiple row selection.

 COLUMN DEFINITION (columns) OPTIONS:
 id                  - Column ID.
 name                - Column name to put in the header.
 toolTip             - Tooltip (if different from name).
 field               - Property of the data context to bind to.
 formatter           - (default 'return value || ""') Function responsible for rendering the contents of a cell. Signature: function formatter(row, cell, value, columnDef, dataContext) { ... return "..."; }
 editor              - An Editor class.
 validator           - An extra validation function to be passed to the editor.
 unselectable        - If true, the cell cannot be selected (and therefore edited).
 cannotTriggerInsert - If true, a new row cannot be created from just the value of this cell.
 width               - Width of the column in pixels.
 resizable           - (default true) If false, the column cannot be resized.
 sortable            - (default false) If true, the column can be sorted (onSort will be called).
 minWidth            - Minimum allowed column width for resizing.
 maxWidth            - Maximum allowed column width for resizing.
 cssClass            - A CSS class to add to the cell.
 rerenderOnResize    - Rerender the column when it is resized (useful for columns relying on cell width or adaptive formatters).
 asyncPostRender     - Function responsible for manipulating the cell DOM node after it has been rendered (called in the background).
 behavior            - Configures the column with one of several available predefined behaviors:  "select", "move", "selectAndMove".


 EVENTS:
 onSort                -
 onHeaderContextMenu   -
 onHeaderClick         -	Matt Baker: Added onHeaderClick for column headers
 onClick               -
 onDblClick            -
 onContextMenu         -
 onKeyDown             -
 onAddNewRow           -
 onValidationError     -
 onViewportChanged     -
 onSelectedRowsChanged -
 onColumnsReordered    -
 onColumnsResized      -
 onBeforeMoveRows      -
 onMoveRows            -
 onCellChange          -  Raised when cell has been edited.   Args: row,cell,dataContext.
 onBeforeEditCell      -  Raised before a cell goes into edit mode.  Return false to cancel.  Args: row,cell,dataContext.
 onBeforeCellEditorDestroy    - Raised before a cell editor is destroyed.  Args: current cell editor.
 onBeforeDestroy       -  Raised just before the grid control is destroyed (part of the destroy() method).
 onCurrentCellChanged  -  Raised when the selected (active) cell changed.  Args: {row:currentRow, cell:currentCell}.
 onCellRangeSelected   -  Raised when a user selects a range of cells.  Args: {from:{row,cell}, to:{row,cell}}.

 NOTES:
 Cell/row DOM manipulations are done directly bypassing jQuery's DOM manipulation methods.
 This increases the speed dramatically, but can only be done safely because there are no event handlers
 or data associated with any cell/row DOM nodes.  Cell editors must make sure they implement .destroy()
 and do proper cleanup.


 @param {NOde}              container   Container node to create the grid in.
 @param {Array} or {Object} data        An array of objects for databinding.
 @param {Array}             columns     An array of column definitions.
 @param {Object}            options     Grid options.
*/
if(typeof jQuery==="undefined")throw Error("SlickGrid requires jquery module to be loaded");if(!jQuery.fn.drag)throw Error("SlickGrid requires jquery.event.drag module to be loaded");
(function(f){function Ya(){var C=null;this.isActive=function(E){return E?C===E:C!==null};this.activate=function(E){if(E!==C){if(C!==null)throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";if(!E.commitCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";if(!E.cancelCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";C=E}};this.deactivate=function(E){if(C!==
E)throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";C=null};this.commitCurrentEdit=function(){return C?C.commitCurrentEdit():true};this.cancelCurrentEdit=function(){return C?C.cancelCurrentEdit():true}}var ba;f.extend(true,window,{Slick:{Grid:function(C,E,h,e){function Fb(){var a=f("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),b={width:a.width()-a[0].clientWidth,height:a.height()-
a[0].clientHeight};a.remove();return b}function Ha(a){p.width(a);Za=a>qa-ba.width}function Gb(a){a&&a.jquery&&a.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})}function la(){return O.length}function $a(a){return O[a]}function Hb(){for(var a=0,b=f.browser.mozilla?5E6:1E9,c=f("<div style='display:none' />").appendTo(document.body);a<=b;){c.css("height",a+1E6);if(c.height()!==a+1E6)break;else a+=1E6}c.remove();return a}function Ib(){for(var a=p[0];(a=
a.parentNode)!=document.body;)if(a==t[0]||a.scrollWidth!=a.clientWidth||a.scrollHeight!=a.clientHeight)f(a).bind("scroll.slickgrid",ab)}function bb(){function a(){f(this).addClass("ui-state-hover")}function b(){f(this).removeClass("ui-state-hover")}var c;A.empty();ra={};for(c=0;c<h.length;c++){var d=h[c]=f.extend({},cb,h[c]);ra[d.id]=c;var g=f("<div class='ui-state-default slick-header-column' id='"+I+d.id+"' />").html("<span class='slick-column-name'>"+d.name+"</span>").width(d.width-sa).attr("title",
d.toolTip||d.name||"").data("fieldId",d.id).appendTo(A);if(e.enableColumnReorder||d.sortable)g.hover(a,b);d.sortable&&g.append("<span class='slick-sort-indicator' />")}Ia(ca,P);db();e.enableColumnReorder&&Jb()}function Kb(){A.click(function(a){if(!f(a.target).hasClass("slick-resizable-handle"))if(i.onSort){a=f(a.target).closest(".slick-header-column");if(a.length){a=h[J(a[0])];if(a.sortable)if(e.editorLock.commitCurrentEdit()){if(a.id===ca)P=!P;else{ca=a.id;P=true}Ia(ca,P);i.onSort(a,P)}}}})}function Jb(){A.sortable({containment:"parent",
axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:true,start:function(a,b){f(b.helper).addClass("slick-header-column-active")},beforeStop:function(a,b){f(b.helper).removeClass("slick-header-column-active")},stop:function(a){if(e.editorLock.commitCurrentEdit()){for(var b=A.sortable("toArray"),c=[],d=0;d<b.length;d++)c.push(h[eb(b[d].replace(I,""))]);fb(c);i.onColumnsReordered&&i.onColumnsReordered();
a.stopPropagation();db()}else f(this).sortable("cancel")}})}function db(){var a,b,c,d,g,j,q,K,da;d=A.children();d.find(".slick-resizable-handle").remove();d.each(function(y){if(h[y].resizable){if(q===undefined)q=y;K=y}});d.each(function(y,F){if(!(q!==undefined&&y<q||e.forceFitColumns&&y>=K)){f(F);f("<div class='slick-resizable-handle' />").appendTo(F).bind("dragstart",function(n){if(!e.editorLock.commitCurrentEdit())return false;c=n.pageX;f(this).parent().addClass("slick-header-column-active");var s=
n=null;d.each(function(Q,Lb){h[Q].previousWidth=f(Lb).outerWidth()});if(e.forceFitColumns){s=n=0;for(a=y+1;a<d.length;a++){b=h[a];if(b.resizable){if(s!==null)if(b.maxWidth)s+=b.maxWidth-b.previousWidth;else s=null;n+=b.previousWidth-Math.max(b.minWidth||0,R)}}}var l=0,S=0;for(a=0;a<=y;a++){b=h[a];if(b.resizable){if(S!==null)if(b.maxWidth)S+=b.maxWidth-b.previousWidth;else S=null;l+=b.previousWidth-Math.max(b.minWidth||0,R)}}if(n===null)n=1E5;if(l===null)l=1E5;if(s===null)s=1E5;if(S===null)S=1E5;j=
c+Math.min(n,S);g=c-Math.min(l,s);da=p.width()}).bind("drag",function(n){var s=Math.min(j,Math.max(g,n.pageX))-c,l;if(s<0){l=s;for(a=y;a>=0;a--){b=h[a];if(b.resizable){n=Math.max(b.minWidth||0,R);if(l&&b.previousWidth+l<n){l+=b.previousWidth-n;G(a,n,e.syncColumnCellResize)}else{G(a,b.previousWidth+l,e.syncColumnCellResize);l=0}}}if(e.forceFitColumns){l=-s;for(a=y+1;a<d.length;a++){b=h[a];if(b.resizable)if(l&&b.maxWidth&&b.maxWidth-b.previousWidth<l){l-=b.maxWidth-b.previousWidth;G(a,b.maxWidth,e.syncColumnCellResize)}else{G(a,
b.previousWidth+l,e.syncColumnCellResize);l=0}}}else e.syncColumnCellResize&&Ha(da+s)}else{l=s;for(a=y;a>=0;a--){b=h[a];if(b.resizable)if(l&&b.maxWidth&&b.maxWidth-b.previousWidth<l){l-=b.maxWidth-b.previousWidth;G(a,b.maxWidth,e.syncColumnCellResize)}else{G(a,b.previousWidth+l,e.syncColumnCellResize);l=0}}if(e.forceFitColumns){l=-s;for(a=y+1;a<d.length;a++){b=h[a];if(b.resizable){n=Math.max(b.minWidth||0,R);if(l&&b.previousWidth+l<n){l+=b.previousWidth-n;G(a,n,e.syncColumnCellResize)}else{G(a,b.previousWidth+
l,e.syncColumnCellResize);l=0}}}}else e.syncColumnCellResize&&Ha(da+s)}}).bind("dragend",function(){var n;f(this).parent().removeClass("slick-header-column-active");for(a=0;a<d.length;a++){b=h[a];n=f(d[a]).outerWidth();b.previousWidth!==n&&b.rerenderOnResize&&T();b.width=e.forceFitColumns?Math.floor(b.width*(n-b.previousWidth)/b.previousWidth)+b.width:n;!e.syncColumnCellResize&&b.previousWidth!==n&&G(a,n,true)}U();i.onColumnsResized&&i.onColumnsResized()})}})}function Mb(){function a(b){return{start:{row:Math.min(b.start.row,
b.end.row),cell:Math.min(b.start.cell,b.end.cell)},end:{row:Math.max(b.start.row,b.end.row),cell:Math.max(b.start.cell,b.end.cell)}}}p.bind("draginit",function(b,c){var d=f(b.target).closest(".slick-cell");if(d.length===0)return false;if(parseInt(d.parent().attr("row"),10)>=u())return false;d=h[J(d[0])];if(d.behavior=="move"||d.behavior=="selectAndMove")c.mode=1;else if(e.enableCellRangeSelection)c.mode=2;else return false}).bind("dragstart",function(b,c){if(!e.editorLock.commitCurrentEdit())return false;
var d=parseInt(f(b.target).closest(".slick-row").attr("row"),10);if(c.mode==1){ta[d]||ma([d]);c.selectionProxy=f("<div class='slick-reorder-proxy'/>").css("position","absolute").css("zIndex","99999").css("width",f(this).innerWidth()).css("height",e.rowHeight*na.length).appendTo(t);c.guide=f("<div class='slick-reorder-guide'/>").css("position","absolute").css("zIndex","99998").css("width",f(this).innerWidth()).css("top",-1000).appendTo(t);c.insertBefore=-1}if(c.mode==2){d=Ja(c.startX-p.offset().left,
c.startY-p.offset().top);if(!Ka(d.row,d.cell))return false;c.range={start:d,end:{}};return f("<div class='slick-selection'></div>").appendTo(p)}}).bind("drag",function(b,c){if(c.mode==1){var d=b.pageY-f(this).offset().top;c.selectionProxy.css("top",d-5);d=Math.max(0,Math.min(Math.round(d/e.rowHeight),u()));if(d!==c.insertBefore){if(i.onBeforeMoveRows&&i.onBeforeMoveRows(ua(),d)===false){c.guide.css("top",-1000);c.canMove=false}else{c.guide.css("top",d*e.rowHeight);c.canMove=true}c.insertBefore=d}}if(c.mode==
2){d=Ja(b.clientX-p.offset().left,b.clientY-p.offset().top);if(Ka(d.row,d.cell)){c.range.end=d;var g=a(c.range);d=gb(g.start.row,g.start.cell);g=gb(g.end.row,g.end.cell);f(c.proxy).css({top:d.top,left:d.left,height:g.bottom-d.top-2,width:g.right-d.left-2})}}}).bind("dragend",function(b,c){if(c.mode==1){c.guide.remove();c.selectionProxy.remove();i.onMoveRows&&c.canMove&&i.onMoveRows(ua(),c.insertBefore)}if(c.mode==2){f(c.proxy).remove();i.onCellRangeSelected&&i.onCellRangeSelected(a(c.range))}})}function Nb(){var a=
f("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo(A);sa=a.outerWidth()-a.width();Ob=a.outerHeight()-a.height();a.remove();var b=f("<div class='slick-row' />").appendTo(p);a=f("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(b);va=a.outerWidth()-a.width();hb=a.outerHeight()-a.height();b.remove();R=Math.max(sa,va)}function ib(){X=f("<style type='text/css' rel='stylesheet' />").appendTo(f("head"));for(var a=["."+I+" .slick-header-column { left: 10000px; }",
"."+I+" .slick-header-columns-secondary {  height:"+e.secondaryHeaderRowHeight+"px; }","."+I+" .slick-cell { height:"+(e.rowHeight-hb)+"px; }"],b=0;b<h.length;b++)a.push("."+I+" .c"+b+" { width:"+((h[b].currentWidth||h[b].width)-va)+"px;  } ");if(X[0].styleSheet)X[0].styleSheet.cssText=a.join("");else X[0].appendChild(document.createTextNode(a.join(" ")));a=document.styleSheets;for(b=0;b<a.length;b++)if((a[b].ownerNode||a[b].owningElement)==X[0]){La=a[b];break}}function eb(a){return ra[a]}function jb(){var a,
b,c=[],d=0,g=e.autoHeight?qa:qa-ba.width,j=0;for(a=j=0;a<h.length;a++){b=h[a];c.push(b.width);j+=b.width;d+=b.width-Math.max(b.minWidth||0,R)}j=j;for(T();j>g;){if(!d)return;var q=(j-g)/d;for(a=0;a<h.length&&j>g;a++){b=h[a];if(!(!b.resizable||b.minWidth===b.width||b.width===R)){b=Math.floor(q*(b.width-Math.max(b.minWidth||0,R)))||1;j-=b;c[a]-=b}}}for(d=j;j<g;){q=g/j;for(a=0;a<h.length&&j<g;a++){b=h[a];if(!(!b.resizable||b.maxWidth<=b.width)){b=Math.min(Math.floor(q*b.width)-b.width,b.maxWidth-b.width||
1E6)||1;j+=b;c[a]+=b}}if(d==j)break;d=j}for(a=0;a<h.length;a++)G(a,h[a].currentWidth=c[a],true);U()}function G(a,b,c){h[a].currentWidth=b;A.children().eq(a).css("width",b-sa);if(c){a:{c=La.cssRules||La.rules;for(var d=0;d<c.length;d++)if(c[d].selectorText=="."+I+" .c"+a){a=c[d];break a}a=null}a.style.width=b-va+"px"}}function Ia(a,b){ca=a;P=b;var c=ra[ca];A.children().removeClass("slick-header-column-sorted");A.find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc");
if(c!=null)A.children().eq(c).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(P?"slick-sort-indicator-asc":"slick-sort-indicator-desc")}function ua(){return na.concat()}function ma(a){var b,c,d={};for(b=0;b<a.length;b++)d[a[b]]=true;for(b=0;b<na.length;b++){c=na[b];r[c]&&!d[c]&&f(r[c]).removeClass("ui-state-active selected")}for(b=0;b<a.length;b++){c=a[b];r[c]&&!ta[c]&&f(r[c]).addClass("ui-state-active selected")}na=a.concat();ta=d}function fb(a){h=a;T();bb();X.remove();
ib();Ma();kb()}function ea(a){var b=w;fa=Math.min(ga-1,Math.floor(a/ha));w=Math.round(fa*wa);a=a-w;if(w!=b){var c=xa(a);lb(c.top,c.bottom);for(var d in r)r[d].style.top=d*e.rowHeight-w+"px"}if(ia!=a){Y=ia+b<a+w?1:-1;t[0].scrollTop=Na=z=ia=a;i.onViewportChanged&&i.onViewportChanged()}}function Pb(a,b,c){return c===null||c===undefined?"":c}function ya(a){return a.formatter||e.formatterFactory&&e.formatterFactory.getFormatter(a)||Pb}function lb(a){for(var b in r)if((b=parseInt(b,10))!==o&&(b<a.top||
b>a.bottom))Oa(b)}function T(){k&&L();p[0].innerHTML="";r={};oa={};Pa+=H;H=0}function Oa(a){var b=r[a];if(b){p[0].removeChild(b);delete r[a];delete oa[a];H--;Pa++}}function mb(a){var b,c;if(a&&a.length){Y=0;var d=[];b=0;for(c=a.length;b<c;b++){k&&o===b&&L();r[a[b]]&&d.push(a[b])}if(H>10&&d.length===H)T();else{b=0;for(a=d.length;b<a;b++)Oa(d[b])}}}function nb(a){mb([a])}function Qa(a){if(r[a]){f(r[a]).children().each(function(b){var c=h[b];if(a===o&&b===v&&k)k.loadValue(x(o));else this.innerHTML=x(a)?
ya(c)(a,b,x(a)[c.field],c,x(a)):""});Ra(a)}}function U(){var a=e.rowHeight*(u()+(e.enableAddRow?1:0)+(e.leaveSpaceForNewRows?za-1:0));e.autoHeight?t.height(a):t.height(B.innerHeight()-Z.outerHeight()-(e.showSecondaryHeaderRow?V.outerHeight():0));qa=t.innerWidth();D=t.innerHeight();za=Math.ceil(D/e.rowHeight);var b=0;A.find(".slick-header-column").each(function(){b+=f(this).outerWidth()});Ha(b);Sa();W()}function Ma(){e.forceFitColumns?jb():U()}function Sa(){var a=u()+(e.enableAddRow?1:0)+(e.leaveSpaceForNewRows?
za-1:0),b=M,c=e.enableAddRow?u():u()-1;for(var d in r)d>=c&&Oa(d);N=Math.max(e.rowHeight*a,D-ba.height);if(N<Aa){M=ha=N;ga=1;wa=0}else{M=Aa;ha=M/100;ga=Math.floor(N/ha);wa=(N-M)/(ga-1)}if(M!==b){p.css("height",M);z=t[0].scrollTop}a=z+w<=N-D;if(N==0||z==0)fa=w=0;else a?ea(z+w):ea(N-D);M!=b&&e.autoHeight&&U()}function xa(){return{top:Math.floor((z+w)/e.rowHeight),bottom:Math.ceil((z+w+D)/e.rowHeight)}}function ob(){if(e.enableAsyncPostRender){clearTimeout(Ta);Ta=setTimeout(pb,e.asyncPostRenderDelay)}}
function Ra(a){delete oa[a];ja=Math.min(ja,a);pa=Math.max(pa,a);ob()}function W(){var a=xa(),b=xa(void 0),c=Math.round(D/e.rowHeight);if(Y==-1){b.top-=c;b.bottom+=3}else if(Y==1){b.top-=3;b.bottom+=c}else{b.top-=3;b.bottom+=3}b.top=Math.max(0,b.top);b.bottom=Math.min(e.enableAddRow?u():u()-1,b.bottom);lb(b);var d,g=p[0],j=H;d=[];var q=[],K=new Date,da=false;for(c=b.top;c<=b.bottom;c++)if(!r[c]){H++;q.push(c);var y=d,F=c,n=x(F),s=void 0;s="slick-row "+(F<u()&&!n?" loading":"")+(ta[F]?" selected ui-state-active":
"")+(F%2==1?" odd":" even");if(e.rowCssClasses)s+=" "+e.rowCssClasses(n);y.push("<div class='ui-widget-content "+s+"' row='"+F+"' style='top:"+(e.rowHeight*F-w)+"px'>");for(var l=0,S=h.length;l<S;l++){var Q=h[l];s="slick-cell c"+l+(Q.cssClass?" "+Q.cssClass:"");if($&&$[F]&&$[F][Q.id])s+=" "+e.cellHighlightCssClass;y.push("<div class='"+s+"'>");n&&y.push(ya(Q)(F,l,n[Q.field],Q,n));y.push("</div>")}y.push("</div>");if(m&&o===c)da=true;qb++}b=document.createElement("div");b.innerHTML=d.join("");c=0;
for(d=b.childNodes.length;c<d;c++)r[q[c]]=g.appendChild(b.firstChild);if(da){m=f(r[o]).children().eq(v)[0];Ua(m,false)}if(H-j>5)Qb=(new Date-K)/(H-j);ja=a.top;pa=Math.min(e.enableAddRow?u():u()-1,a.bottom);ob();Na=z;Ba=null}function kb(){z=t[0].scrollTop;var a=t[0].scrollLeft,b=Math.abs(z-ia);if(a!==rb){rb=a;Z[0].scrollLeft=a;V[0].scrollLeft=a}if(b){Y=ia<z?1:-1;ia=z;if(b<D)ea(z+w);else{a=w;fa=Math.min(ga-1,Math.floor(z*((N-D)/(M-D))*(1/ha)));w=Math.round(fa*wa);a!=w&&T()}Ba&&clearTimeout(Ba);if(Math.abs(Na-
z)<D)W();else Ba=setTimeout(W,50);i.onViewportChanged&&i.onViewportChanged()}}function pb(){for(;ja<=pa;){var a=Y>=0?ja++:pa--,b=r[a];if(!(!b||oa[a]||a>=u())){var c=x(a);b=b.childNodes;for(var d=0,g=0,j=h.length;d<j;++d){var q=h[d];q.asyncPostRender&&q.asyncPostRender(b[g],ja,c,q);++g}oa[a]=true;Ta=setTimeout(pb,e.asyncPostRenderDelay);return}}}function J(a){for(var b=0;a&&a.previousSibling;){b++;a=a.previousSibling}return b}function Rb(a){if(!(i.onKeyDown&&!e.editorLock.isActive()&&i.onKeyDown(a,
o,v)))if(!a.shiftKey&&!a.altKey&&!a.ctrlKey)if(a.which==27){if(!e.editorLock.isActive())return;sb()}else if(a.which==37)tb();else if(a.which==39)ub();else if(a.which==38)vb();else if(a.which==40)Ca();else if(a.which==9)wb();else if(a.which==13){if(e.editable)if(k)o===la()?Ca():xb();else e.editorLock.commitCurrentEdit()&&Da()}else return;else if(a.which==9&&a.shiftKey&&!a.ctrlKey&&!a.altKey)yb();else return;a.stopPropagation();a.preventDefault();try{a.originalEvent.keyCode=0}catch(b){}}function Sb(a){var b=
f(a.target).closest(".slick-cell",p);if(b.length!==0)if(!(m===b[0]&&k!==null)){var c=parseInt(b.parent().attr("row"),10),d=J(b[0]),g=null,j=h[d],q=x(c);if(q&&(j.behavior==="selectAndMove"||j.behavior==="select"||a.ctrlKey||a.shiftKey))if(g=e.editorLock.commitCurrentEdit()){b=ua();d=f.inArray(c,b);if(!a.ctrlKey&&!a.shiftKey&&!a.metaKey)b=[c];else if(e.multiSelect)if(d===-1&&(a.ctrlKey||a.metaKey))b.push(c);else if(d!==-1&&(a.ctrlKey||a.metaKey))b=f.grep(b,function(K){return K!==c});else if(b.length&&
a.shiftKey){a=b.pop();g=Math.min(c,a);d=Math.max(c,a);b=[];for(g=g;g<=d;g++)g!==a&&b.push(g);b.push(a)}zb();ma(b);i.onSelectedRowsChanged&&i.onSelectedRowsChanged();f.browser.msie||p[0].focus();return false}if(q&&i.onClick)if(g=e.editorLock.commitCurrentEdit())if(i.onClick(a,c,d)){a.stopPropagation();a.preventDefault();return false}if(e.enableCellNavigation&&!h[d].unselectable)if(g===true||g===null&&e.editorLock.commitCurrentEdit()){Ea(c,false);Va(b[0],c===la()||e.autoEdit)}}}function Tb(a){var b=
f(a.target).closest(".slick-cell",p);if(b.length!==0)if(!(m===b[0]&&k!==null)){var c=parseInt(b.parent().attr("row"),10);b=J(b[0]);var d=null;if(x(c)&&i.onContextMenu)if(d=e.editorLock.commitCurrentEdit())if(i.onContextMenu(a,c,b)){a.stopPropagation();a.preventDefault();return false}}}function Ub(a){var b=f(a.target).closest(".slick-cell",p);if(b.length!==0)if(!(m===b[0]&&k!==null)){var c=parseInt(b.parent().attr("row"),10);b=J(b[0]);var d=null;if(x(c)&&i.onDblClick)if(d=e.editorLock.commitCurrentEdit())if(i.onDblClick(a,
c,b)){a.stopPropagation();a.preventDefault();return false}e.editable&&Ab(c,b,true)}}function Vb(a){if(i.onHeaderContextMenu&&e.editorLock.commitCurrentEdit()){a.preventDefault();var b=f(a.target).closest(".slick-header-column",".slick-header-columns");i.onHeaderContextMenu(a,h[i.getColumnIndex(b.data("fieldId"))])}}function Wb(a){var b=f(a.target).closest(".slick-header-column");if(b.length!=0){b=h[J(b[0])];if(i.onHeaderClick&&e.editorLock.commitCurrentEdit()){a.preventDefault();i.onHeaderClick(a,
b)}}}function Xb(a){if(e.enableAutoTooltips){a=f(a.target).closest(".slick-cell",p);if(a.length)if(a.innerWidth()<a[0].scrollWidth){var b=f.trim(a.text());a.attr("title",e.toolTipMaxLength&&b.length>e.toolTipMaxLength?b.substr(0,e.toolTipMaxLength-3)+"...":b)}else a.attr("title","")}}function Ka(a,b){return!(a<0||a>=u()||b<0||b>=h.length)}function Ja(a,b){for(var c=Math.floor((b+w)/e.rowHeight),d=0,g=0,j=0;j<h.length&&g<a;j++){g+=h[j].width;d++}return{row:c,cell:d-1}}function gb(a,b){if(!Ka(a,b))return null;
for(var c=a*e.rowHeight-w,d=c+e.rowHeight-1,g=0,j=0;j<b;j++)g+=h[j].width;return{top:c,left:g,bottom:d,right:g+h[b].width}}function zb(){Ua(null,false)}function aa(){f(m).attr("tabIndex",0).attr("hideFocus",true);if(f.browser.msie&&parseInt(f.browser.version)<8){m.setActive();var a=f(m).position().left,b=a+f(m).outerWidth(),c=t.scrollLeft(),d=c+t.width();if(a<c)t.scrollLeft(a);else b>d&&t.scrollLeft(Math.min(a,b-t[0].clientWidth))}else m.focus()}function Ua(a,b){if(m!==null){L();f(m).removeClass("selected")}m=
a;if(m!=null){o=parseInt(f(m).parent().attr("row"),10);v=J(m);f(m).addClass("selected");if(e.editable&&b&&Bb(o,v)){clearTimeout(Wa);if(e.asyncEditorLoading)Wa=setTimeout(Da,e.asyncEditorLoadDelay);else Da()}else aa();i.onCurrentCellChanged&&i.onCurrentCellChanged(Cb())}else v=o=null}function Va(a,b){Ua(a,b);a?ma([o]):ma([]);i.onSelectedRowsChanged&&i.onSelectedRowsChanged()}function Bb(a,b){if(a<u()&&!x(a))return false;if(h[b].cannotTriggerInsert&&a>=u())return false;if(!(h[b].editor||e.editorFactory&&
e.editorFactory.getEditor(h[b])))return false;return true}function L(){if(k){i.onBeforeCellEditorDestroy&&i.onBeforeCellEditorDestroy(k);k.destroy();k=null;if(m){f(m).removeClass("editable invalid");if(x(o)){var a=h[v];m.innerHTML=ya(a)(o,v,x(o)[a.field],a,x(o));Ra(o)}}if(f.browser.msie)if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection)(a=window.getSelection())&&a.removeAllRanges&&a.removeAllRanges();e.editorLock.deactivate(Fa)}}function Da(){if(m){if(!e.editable)throw"Grid : makeSelectedCellEditable : should never get called when options.editable is false";
clearTimeout(Wa);if(Bb(o,v))if(i.onBeforeEditCell&&i.onBeforeEditCell(o,v,x(o))===false)aa();else{e.editorLock.activate(Fa);f(m).addClass("editable");m.innerHTML="";var a=h[v],b=x(o);k=new (a.editor||e.editorFactory&&e.editorFactory.getEditor(a))({grid:i,gridPosition:Ga(B[0]),position:Ga(m),container:m,column:a,item:b||{},commitChanges:xb,cancelChanges:sb});b&&k.loadValue(b);Db=k.serializeValue();k.position&&ab()}}}function xb(){if(e.editorLock.commitCurrentEdit()){aa();e.autoEdit&&Ca()}}function sb(){e.editorLock.cancelCurrentEdit()&&
aa()}function Ga(a){var b={top:a.offsetTop,left:a.offsetLeft,bottom:0,right:0,width:f(a).outerWidth(),height:f(a).outerHeight(),visible:true};b.bottom=b.top+b.height;b.right=b.left+b.width;for(var c=a.offsetParent;(a=a.parentNode)!=document.body;){if(b.visible&&a.scrollHeight!=a.offsetHeight&&f(a).css("overflowY")!="visible")b.visible=b.bottom>a.scrollTop&&b.top<a.scrollTop+a.clientHeight;if(b.visible&&a.scrollWidth!=a.offsetWidth&&f(a).css("overflowX")!="visible")b.visible=b.right>a.scrollLeft&&
b.left<a.scrollLeft+a.clientWidth;b.left-=a.scrollLeft;b.top-=a.scrollTop;if(a===c){b.left+=a.offsetLeft;b.top+=a.offsetTop;c=a.offsetParent}b.bottom=b.top+b.height;b.right=b.left+b.width}return b}function Xa(){return Ga(m)}function ab(){if(m){var a;if(i.onCurrentCellPositionChanged){a=Xa();i.onCurrentCellPositionChanged(a)}if(k){a=a||Xa();if(k.show&&k.hide)a.visible?k.show():k.hide();k.position&&k.position(a)}}}function Cb(){return m?{row:o,cell:v}:null}function Ea(a,b){var c=a*e.rowHeight,d=(a+
1)*e.rowHeight-D+(Za?ba.height:0);if((a+1)*e.rowHeight>z+D+w){ea(b?c:d);W()}else if(a*e.rowHeight<z+w){ea(b?d:c);W()}}function ka(a,b,c){function d(){return!h[J(this)].unselectable}if(m&&e.enableCellNavigation)if(e.editorLock.commitCurrentEdit()){var g=r[o+a],j=g&&v+b>=0?f(g).children().eq(v+b).filter(d):null;if(j&&!j.length){var q=f(g).children().filter(function(K){return b>0?K>v+b:K<v+b}).filter(d);if(q&&q.length)j=b>0?q.eq(0):q.eq(q.length-1)}if(c&&a===0&&!(g&&j&&j.length))if(!j||!j.length){g=
r[o+a+(b>0?1:-1)];q=f(g).children().filter(d);j=b>0?g?q.eq(0):null:g?q.eq(q.length-1):null}if(g&&j&&j.length){a=parseInt(f(g).attr("row"),10);c=a==la();Ea(a,!c);Va(j[0],c||e.autoEdit);k||aa()}else aa()}}function Ab(a,b,c){if(!(a>u()||a<0||b>=h.length||b<0))if(!(!e.enableCellNavigation||h[b].unselectable))if(e.editorLock.commitCurrentEdit()){Ea(a,false);var d=null;h[b].unselectable||(d=f(r[a]).children().eq(b)[0]);Va(d,c||a===u()||e.autoEdit);k||aa()}}function vb(){ka(-1,0,false)}function Ca(){ka(1,
0,false)}function tb(){ka(0,-1,false)}function ub(){ka(0,1,false)}function yb(){ka(0,-1,true)}function wb(){ka(0,1,true)}function Yb(){var a=x(o),b=h[v];if(k){if(k.isValueChanged()){var c=k.validate();if(c.valid){if(o<u()){c={row:o,cell:v,editor:k,serializedValue:k.serializeValue(),prevSerializedValue:Db,execute:function(){this.editor.applyValue(a,this.serializedValue);Qa(this.row)},undo:function(){this.editor.applyValue(a,this.prevSerializedValue);Qa(this.row)}};if(e.editCommandHandler){L();e.editCommandHandler(a,
b,c)}else{c.execute();L()}i.onCellChange&&i.onCellChange(o,v,a)}else if(i.onAddNewRow){c={};k.applyValue(c,k.serializeValue());L();i.onAddNewRow(c,b)}return!e.editorLock.isActive()}else{f(m).addClass("invalid");f(m).stop(true,true).effect("highlight",{color:"red"},300);i.onValidationError&&i.onValidationError(m,c,o,v,b);k.focus();return false}}L()}return true}function Zb(){L();return true}var $b={rowHeight:25,defaultColumnWidth:80,enableAddRow:false,leaveSpaceForNewRows:false,editable:false,autoEdit:true,
enableCellNavigation:true,enableCellRangeSelection:false,enableColumnReorder:true,asyncEditorLoading:false,asyncEditorLoadDelay:100,forceFitColumns:false,enableAsyncPostRender:false,asyncPostRenderDelay:60,autoHeight:false,editorLock:Slick.GlobalEditorLock,showSecondaryHeaderRow:false,secondaryHeaderRowHeight:25,syncColumnCellResize:false,enableAutoTooltips:true,toolTipMaxLength:null,formatterFactory:null,editorFactory:null,cellHighlightCssClass:"highlighted",cellFlashingCssClass:"flashing",multiSelect:true},
O,u,x,cb={name:"",resizable:true,sortable:false,minWidth:30},Aa,N,M,ha,ga,wa,fa=0,w=0,Y=1,B,I="slickgrid_"+Math.round(1E6*Math.random()),i=this,Z,A,V,Eb,t,p,X,La,D,qa,Za,sa,Ob,va,hb,R,o,v,m=null,k=null,Db,Fa,r={},H=0,za,ia=0,z=0,Na=0,rb=0,Qb=10,na=[],ta={},ra={},$,ca,P=true,Wa=null,Ba=null,Ta=null,oa={},pa=null,ja=null,qb=0,Pa=0;this.debug=function(){var a="";a+="\ncounter_rows_rendered:  "+qb;a+="\ncounter_rows_removed:  "+Pa;a+="\nrenderedRows:  "+H;a+="\nnumVisibleRows:  "+za;a+="\nmaxSupportedCssHeight:  "+
Aa;a+="\nn(umber of pages):  "+ga;a+="\n(current) page:  "+fa;a+="\npage height (ph):  "+ha;a+="\nscrollDir:  "+Y;alert(a)};this.eval=function(a){return eval(a)};(function(){B=f(C);O=E;u=O.getLength||la;x=O.getItem||$a;Aa=Hb();ba=ba||Fb();e=f.extend({},$b,e);cb.width=e.defaultColumnWidth;if(e.enableColumnReorder&&!f.fn.sortable)throw Error('SlickGrid\'s "enableColumnReorder = true" option requires jquery-ui.sortable module to be loaded');Fa={commitCurrentEdit:Yb,cancelCurrentEdit:Zb};B.empty().attr("tabIndex",
0).attr("hideFocus",true).css("overflow","hidden").css("outline",0).addClass(I).addClass("ui-widget");/relative|absolute|fixed/.test(B.css("position"))||B.css("position","relative");Z=f("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo(B);A=f("<div class='slick-header-columns' style='width:100000px; left:-10000px' />").appendTo(Z);V=f("<div class='slick-header-secondary ui-state-default' style='overflow:hidden;position:relative;' />").appendTo(B);
Eb=f("<div class='slick-header-columns-secondary' style='width:100000px' />").appendTo(V);e.showSecondaryHeaderRow||V.hide();t=f("<div class='slick-viewport' tabIndex='0' hideFocus style='width:100%;overflow-x:auto;outline:0;position:relative;overflow-y:auto;'>").appendTo(B);p=f("<div class='grid-canvas' tabIndex='0' hideFocus />").appendTo(t);Nb();t.height(B.innerHeight()-Z.outerHeight()-(e.showSecondaryHeaderRow?V.outerHeight():0));Gb(A);t.bind("selectstart.ui",function(a){return f(a.target).is("input,textarea")});
bb();Kb();Mb();ib();Ma();Ib();t.bind("scroll",kb);B.bind("resize",Ma);p.bind("keydown",Rb);p.bind("click",Sb);p.bind("dblclick",Ub);p.bind("contextmenu",Tb);p.bind("mouseover",Xb);Z.bind("contextmenu",Vb);Z.bind("click",Wb)})();f.extend(this,{slickGridVersion:"1.4.2",onSort:null,onHeaderContextMenu:null,onClick:null,onDblClick:null,onContextMenu:null,onKeyDown:null,onAddNewRow:null,onValidationError:null,onViewportChanged:null,onSelectedRowsChanged:null,onColumnsReordered:null,onColumnsResized:null,
onBeforeMoveRows:null,onMoveRows:null,onCellChange:null,onBeforeEditCell:null,onBeforeCellEditorDestroy:null,onBeforeDestroy:null,onCurrentCellChanged:null,onCurrentCellPositionChanged:null,onCellRangeSelected:null,getColumns:function(){return h},setColumns:fb,getOptions:function(){return e},setOptions:function(a){if(e.editorLock.commitCurrentEdit()){L();e.enableAddRow!==a.enableAddRow&&nb(u());e=f.extend(e,a);W()}},setData:function(a,b){T();O=E=a;u=O.getLength||la;x=O.getItem||$a;b&&ea(0)},destroy:function(){e.editorLock.cancelCurrentEdit();
i.onBeforeDestroy&&i.onBeforeDestroy();A.sortable&&A.sortable("destroy");p.parents().unbind("scroll.slickgrid");B.unbind("resize",U);X.remove();p.unbind("draginit dragstart dragend drag");B.empty().removeClass(I)},getColumnIndex:eb,autosizeColumns:jb,updateCell:function(a,b){if(r[a]){var c=f(r[a]).children().eq(b);if(c.length!==0){var d=h[b],g=x(a);if(k&&o===a&&v===b)k.loadValue(g);else{c[0].innerHTML=g?ya(d)(a,b,g[d.field],d,g):"";Ra(a)}}}},updateRow:Qa,removeRow:nb,removeRows:mb,removeAllRows:T,
render:W,invalidate:function(){Sa();T();W()},setHighlightedCells:function(a){var b,c,d;for(var g in r)for(b=0;b<h.length;b++){d=$&&$[g]&&$[g][h[b].id];c=a&&a[g]&&a[g][h[b].id];if(d!=c){c=f(r[g]).children().eq(b);c.length&&c.toggleClass(e.cellHighlightCssClass)}}$=a},flashCell:function(a,b,c){c=c||100;if(r[a]){var d=f(r[a]).children().eq(b),g=function(j){j&&setTimeout(function(){d.queue(function(){d.toggleClass(e.cellFlashingCssClass).dequeue();g(j-1)})},c)};g(4)}},getViewport:xa,resizeCanvas:U,updateRowCount:Sa,
getCellFromPoint:Ja,getCellFromEvent:function(a){a=f(a.target).closest(".slick-cell",p);if(!a.length)return null;return{row:a.parent().attr("row")|0,cell:J(a[0])}},getCurrentCell:Cb,getCurrentCellNode:function(){return m},resetCurrentCell:zb,navigatePrev:yb,navigateNext:wb,navigateUp:vb,navigateDown:Ca,navigateLeft:tb,navigateRight:ub,gotoCell:Ab,editCurrentCell:Da,getCellEditor:function(){return k},scrollRowIntoView:Ea,getSelectedRows:ua,setSelectedRows:ma,getSecondaryHeaderRow:function(){return Eb[0]},
showSecondaryHeaderRow:function(){e.showSecondaryHeaderRow=true;V.slideDown("fast",U)},hideSecondaryHeaderRow:function(){e.showSecondaryHeaderRow=false;V.slideUp("fast",U)},setSortColumn:Ia,getCurrentCellPosition:Xa,getGridPosition:function(){return Ga(B[0])},getEditController:function(){return Fa}})},EditorLock:Ya,GlobalEditorLock:new Ya}})})(jQuery);